(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{189:function(t,s,a){"use strict";a.r(s);var n=a(0),_=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[a("h1",{attrs:{id:"信号量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#信号量","aria-hidden":"true"}},[t._v("#")]),t._v(" 信号量")]),a("h2",{attrs:{id:"概述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概述","aria-hidden":"true"}},[t._v("#")]),t._v(" 概述")]),a("h3",{attrs:{id:"基本概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本概念","aria-hidden":"true"}},[t._v("#")]),t._v(" 基本概念")]),a("p",[t._v("信号量（Semaphore）是一种实现任务间通信的机制，实现任务之间同步或临界资源的互斥访问。常用于协助一组相互竞争的任务来访问临界资源。")]),a("p",[t._v("在多任务系统中，各任务之间需要同步或互斥实现临界资源的保护，信号量功能可以为用户提供这方面的支持。")]),a("p",[t._v("通常一个信号量的计数值用于对应有效的资源数，表示剩下的可被占用的互斥资源数。其值的含义分两种情况：")]),a("ul",[a("li",[a("p",[t._v("0，表示没有积累下来的 Post 操作，且有可能有在此信号量上阻塞的任务。")])]),a("li",[a("p",[t._v("正值，表示有一个或多个 Post 下来的释放操作。")])])]),a("p",[t._v("以同步为目的的信号量和以互斥为目的的信号量在使用有如下不同：")]),a("ul",[a("li",[a("p",[t._v("用作互斥时，信号量创建后记数是满的，在需要使用临界资源时，先取信号量，使其变空，这样其他任务需要使用临界资源时就会因为无法取到信号量而阻塞，从而保证了临界资源的安全。")])]),a("li",[a("p",[t._v("用作同步时，信号量在创建后被置为空，任务1取信号量而阻塞，任务2在某种条件发生后，释放信号量，于是任务1得以进入 READY 或 RUNNING 态，从而达到了两个任务间的同步。")])])]),a("h3",{attrs:{id:"运作机制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运作机制","aria-hidden":"true"}},[t._v("#")]),t._v(" 运作机制")]),a("p",[a("strong",[t._v("信号量控制块")])]),a("div",{staticClass:"language-c extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("typedef")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("struct")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    UINT16           usSemStat"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("          "),a("span",{attrs:{class:"token comment"}},[t._v("/**是否使用标志位*/")]),t._v("\n    UINT16          uwSemCount"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("         "),a("span",{attrs:{class:"token comment"}},[t._v("/**信号量索引号*/")]),t._v("\n    UINT16          usMaxSemCount"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("      "),a("span",{attrs:{class:"token comment"}},[t._v("/**信号量最大数*/")]),t._v("\n    UINT16          usSemID"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("            "),a("span",{attrs:{class:"token comment"}},[t._v("/**信号量计数*/")]),t._v("\n    LOS_DL_LIST     stSemList"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("          "),a("span",{attrs:{class:"token comment"}},[t._v("/**挂接阻塞于该信号量的任务*/")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" SEM_CB_S"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n")])])]),a("p",[a("strong",[t._v("信号量运作原理")])]),a("p",[t._v("信号量初始化，为配置的 N 个信号量申请内存（N值可以由用户自行配置，受内存限制），并把所有的信号量初始化成未使用，并加入到未使用链表中供系统使用。")]),a("p",[t._v("信号量创建，从未使用的信号量链表中获取一个信号量资源，并设定初值。")]),a("p",[t._v("信号量申请，若其计数器值大于 0，则直接减 1 返回成功。否则任务阻塞，等待其它任务释放该信号量，等待的超时时间可设定。当任务被一个信号量阻塞时，将该任务挂到信号量等待任务队列的队尾。")]),a("p",[t._v("信号量释放，若没有任务等待该信号量，则直接将计数器加1返回。否则唤醒该信号量等待任务队列上的第一个任务。")]),a("p",[t._v("信号量删除，将正在使用的信号量置为未使用信号量，并挂回到未使用链表。")]),a("p",[t._v("信号量允许多个任务在同一时刻访问同一资源，但会限制同一时刻访问此资源的最大任务数目。访问同一资源的任务数达到该资源的最大数量时，会阻塞其他试图获取该资源的任务，直到有任务释放该信号量。")]),a("p",[t._v("信号量运作示意图")]),a("h2",{attrs:{id:"开发指导"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开发指导","aria-hidden":"true"}},[t._v("#")]),t._v(" 开发指导")]),a("h3",{attrs:{id:"使用场景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用场景","aria-hidden":"true"}},[t._v("#")]),t._v(" 使用场景")]),a("p",[t._v("信号量是一种非常灵活的同步方式，可以运用在多种场合中，实现锁、同步、资源计数等功能，也能方便的用于任务与任务，中断与任务的同步中。")]),a("h3",{attrs:{id:"功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#功能","aria-hidden":"true"}},[t._v("#")]),t._v(" 功能")]),a("p",[t._v("Huawei LiteOS 系统中的信号量模块为用户提供下面几种功能。")]),a("table",[a("thead",[a("tr",[a("th",[t._v("功能分类")]),a("th",[t._v("接口名")]),a("th",[t._v("描述")])])]),a("tbody",[a("tr",[a("td",[t._v("信号量的创建和删除")]),a("td",[t._v("LOS_SemCreate")]),a("td",[t._v("创建信号量")])]),a("tr",[a("td"),a("td",[t._v("LOS_BinarySemCreate")]),a("td",[t._v("创建二进制信号量")])]),a("tr",[a("td"),a("td",[t._v("LOS_SemDelete")]),a("td",[t._v("删除指定的信号量")])]),a("tr",[a("td",[t._v("信号量的申请和释放")]),a("td",[t._v("LOS_SemPend")]),a("td",[t._v("申请指定的信号量")])]),a("tr",[a("td"),a("td",[t._v("LOS_SemPost")]),a("td",[t._v("释放指定的信号量")])])])]),a("h3",{attrs:{id:"开发流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开发流程","aria-hidden":"true"}},[t._v("#")]),t._v(" 开发流程")]),a("p",[t._v("信号量的开发典型流程：")]),a("ol",[a("li",[a("p",[a("strong",[t._v("创建信号量")]),a("code",[t._v("LOS_SemCreate")]),t._v("。")])]),a("li",[a("p",[a("strong",[t._v("申请信号量")]),a("code",[t._v("LOS_SemPend")]),t._v("。")]),a("p",[t._v("信号量有三种申请模式：无阻塞模式、永久阻塞模式、定时阻塞模式")]),a("ul",[a("li",[a("p",[a("strong",[t._v("无阻塞模式")]),t._v("：任务需要申请信号量，若当前信号量的任务数没有到信号量设定的上限，则申请成功。否则，立即返回申请失败")])]),a("li",[a("p",[a("strong",[t._v("永久阻塞模式")]),t._v("：任务需要申请信号量，若当前信号量的任务数没有到信号量设定的上限，则申请成功。否则，该任务进入阻塞态，系统切换到就绪任务中优先级最高者继续执行。任务进入阻塞态后，直到有其他任务释放该信号量，阻塞任务才会重新得以执行")])]),a("li",[a("p",[a("strong",[t._v("定时阻塞模式")]),t._v("：任务需要申请信号量，若当前信号量的任务数没有到信号量设定的上限，则申请成功。否则，该任务进入阻塞态，系统切换到就绪任务中优先级最高者继续执行。任务进入阻塞态后，指定时间超时前有其他任务释放该信号量，或者用户指定时间超时后，阻塞任务才会重新得以执行")])])])]),a("li",[a("p",[a("strong",[t._v("释放信号量")]),a("code",[t._v("LOS_SemPost")]),t._v("。")]),a("ul",[a("li",[a("p",[t._v("如果有任务阻塞于指定信号量，则唤醒该信号量阻塞队列上的第一个任务。该任务进入就绪态，并进行调度")])]),a("li",[a("p",[t._v("如果没有任务阻塞于指定信号量，释放信号量成功")])])])]),a("li",[a("p",[a("strong",[t._v("删除信号量")]),a("code",[t._v("LOS_SemDelete")]),t._v("。")])])]),a("h3",{attrs:{id:"信号量错误码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#信号量错误码","aria-hidden":"true"}},[t._v("#")]),t._v(" 信号量错误码")]),a("p",[t._v("对可能导致信号量操作失败的情况，包括创建信号量、申请信号量、释放信号量、删除信号量等，均需要返回对应的错误码，以便快速定位错误原因。")]),a("table",[a("thead",[a("tr",[a("th",[t._v("序号")]),a("th",[t._v("定义")]),a("th",[t._v("实际数值")]),a("th",[t._v("描述")]),a("th",[t._v("参考解决方案")])])]),a("tbody",[a("tr",[a("td",[t._v("1")]),a("td",[a("code",[t._v("LOS_ERRNO_SEM_NO_MEMORY")])]),a("td",[t._v("0x02000700")]),a("td",[t._v("内存空间不足")]),a("td",[t._v("分配更大的内存分区")])]),a("tr",[a("td",[t._v("2")]),a("td",[a("code",[t._v("LOS_ERRNO_SEM_INVALID")])]),a("td",[t._v("0x02000701")]),a("td",[t._v("非法传参")]),a("td",[t._v("改变传数为合法值")])]),a("tr",[a("td",[t._v("3")]),a("td",[a("code",[t._v("LOS_ERRNO_SEM_PTR_NULL")])]),a("td",[t._v("0x02000702")]),a("td",[t._v("传入空指针")]),a("td",[t._v("传入合法指针")])]),a("tr",[a("td",[t._v("4")]),a("td",[a("code",[t._v("LOS_ERRNO_SEM_ALL_BUSY")])]),a("td",[t._v("0x02000703")]),a("td",[t._v("信号量控制块不可用")]),a("td",[t._v("释放资源信号量资源")])]),a("tr",[a("td",[t._v("5")]),a("td",[a("code",[t._v("LOS_ERRNO_SEM_UNAVAILABLE")])]),a("td",[t._v("0x02000704")]),a("td",[t._v("定时时间非法")]),a("td",[t._v("传入正确的定时时间")])]),a("tr",[a("td",[t._v("6")]),a("td",[a("code",[t._v("LOS_ERRNO_SEM_PEND_INTERR")])]),a("td",[t._v("0x02000705")]),a("td",[t._v("中断期间非法调用LOS_SemPend")]),a("td",[t._v("中断期间禁止调用LOS_SemPend")])]),a("tr",[a("td",[t._v("7")]),a("td",[a("code",[t._v("LOS_ERRNO_SEM_PEND_IN_LOCK")])]),a("td",[t._v("0x02000706")]),a("td",[t._v("任务被锁，无法获得信号量")]),a("td",[t._v("在任务被锁时，不能调用LOS_SemPend")])]),a("tr",[a("td",[t._v("8")]),a("td",[a("code",[t._v("LOS_ERRNO_SEM_TIMEOUT")])]),a("td",[t._v("0x02000707")]),a("td",[t._v("获取信号量时间超时")]),a("td",[t._v("将时间设置在合理范围内")])]),a("tr",[a("td",[t._v("9")]),a("td",[a("code",[t._v("LOS_ERRNO_SEM_OVERFLOW")])]),a("td",[t._v("0x02000708")]),a("td",[t._v("信号量允许pend次数超过最大值")]),a("td",[t._v("传入合法的值")])]),a("tr",[a("td",[t._v("10")]),a("td",[a("code",[t._v("LOS_ERRNO_SEM_PENDED")])]),a("td",[t._v("0x02000709")]),a("td",[t._v("等待信号量的任务队列不为空")]),a("td",[t._v("唤醒所有等待该型号量的任务后删除该信号量")])])])]),a("p",[a("strong",[t._v("错误码定义：")]),t._v(" 错误码是一个32位的存储单元，31~24位表示错误等级，23~16位表示错误码标志，15~8位代表错误码所属模块，7~0位表示错误码序号，如下")]),a("div",{staticClass:"language-c extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token macro property"}},[t._v("#"),a("span",{attrs:{class:"token directive keyword"}},[t._v("define")]),t._v(" LOS_ERRNO_OS_NORMAL(MID,ERRNO)  \\\n(LOS_ERRTYPE_NORMAL | LOS_ERRNO_OS_ID | ((UINT32)(MID) << 8) | (ERRNO))")]),t._v("\n")])])]),a("div",{staticClass:"tip custom-block"},[a("p",{staticClass:"custom-block-title"},[t._v("举例")]),a("ul",[a("li",[t._v("LOS_ERRTYPE_NORMAL ：Define the error level as critical")]),a("li",[t._v("LOS_ERRNO_OS_ID ：OS error code flag.")]),a("li",[t._v("MID：OS_MOUDLE_ID")]),a("li",[t._v("ERRNO：error ID number")])]),a("div",{staticClass:"language-c extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[t._v("LOS_ERRNO_SEM_NO_MEMORY        "),a("span",{attrs:{class:"token function"}},[t._v("LOS_ERRNO_OS_ERROR")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LOS_MOD_SEM"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("0x00")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  \n")])])])]),a("h2",{attrs:{id:"注意事项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注意事项","aria-hidden":"true"}},[t._v("#")]),t._v(" 注意事项")]),a("ul",[a("li",[t._v("由于中断不能被阻塞，因此在申请信号量时，阻塞模式不能在中断中使用。")])]),a("h2",{attrs:{id:"编程实例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编程实例","aria-hidden":"true"}},[t._v("#")]),t._v(" 编程实例")]),a("h3",{attrs:{id:"实例描述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实例描述","aria-hidden":"true"}},[t._v("#")]),t._v(" 实例描述")]),a("p",[t._v("本实例实现如下功能：")]),a("ol",[a("li",[a("p",[t._v("测试任务 "),a("code",[t._v("Example_TaskEntry")]),t._v(" 创建一个信号量，锁任务调度，创建两个任务 "),a("code",[t._v("Example_SemTask1")]),t._v("、"),a("code",[t._v("Example_SemTask2")]),t._v(", "),a("code",[t._v("Example_SemTask2")]),t._v("优先级高于 "),a("code",[t._v("Example_SemTask1")]),t._v("，两个任务中申请同一信号量，解锁任务调度后两任务阻塞，测试任务 "),a("code",[t._v("Example_TaskEntry")]),t._v(" 释放信号量。")])]),a("li",[a("p",[a("code",[t._v("Example_SemTask2")]),t._v(" 得到信号量，被调度，然后任务休眠 20Tick，"),a("code",[t._v("Example_SemTask2")]),t._v(" 延迟，"),a("code",[t._v("Example_SemTask1")]),t._v(" 被唤醒。")])]),a("li",[a("p",[a("code",[t._v("Example_SemTask1")]),t._v(" 定时阻塞模式申请信号量，等待时间为10Tick，因信号量仍被 "),a("code",[t._v("Example_SemTask2")]),t._v(" 持有，"),a("code",[t._v("Example_SemTask1")]),t._v(" 挂起，10Tick 后仍未得到信号量，"),a("code",[t._v("Example_SemTask1")]),t._v(" 被唤醒，试图以永久阻塞模式申请信号量，"),a("code",[t._v("Example_SemTask1")]),t._v(" 挂起。")])]),a("li",[a("p",[t._v("20Tick 后 "),a("code",[t._v("Example_SemTask2")]),t._v(" 唤醒， 释放信号量后，"),a("code",[t._v("Example_SemTask1")]),t._v(" 得到信号量被调度运行，最后释放信号量。")])]),a("li",[a("p",[a("code",[t._v("Example_SemTask1")]),t._v(" 执行完，40Tick 后任务 "),a("code",[t._v("Example_TaskEntry")]),t._v(" 被唤醒。")])])]),a("h3",{attrs:{id:"编程示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编程示例","aria-hidden":"true"}},[t._v("#")]),t._v(" 编程示例")]),a("p",[t._v("前提条件：")]),a("p",[t._v("在 "),a("code",[t._v("los_config.h")]),t._v(" 中，将 "),a("code",[t._v("LOSCFG_BASE_IPC_SEM")]),t._v(" 配置为 YES。")]),a("p",[t._v("配置用户定义的 "),a("code",[t._v("LOSCFG_BASE_IPC_SEM_LIMIT")]),t._v(" 最大的信号量数，如 1024。")]),a("p",[t._v("代码实现如下：")]),a("div",{staticClass:"language-c extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{attrs:{class:"token comment"}},[t._v("/*测试任务优先级*/")]),t._v("\n"),a("span",{attrs:{class:"token macro property"}},[t._v("#"),a("span",{attrs:{class:"token directive keyword"}},[t._v("define")]),t._v(" TASK_PRIO_TEST  5")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("/*任务PID*/")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("static")]),t._v(" UINT32 g_TestTaskID01"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("g_TestTaskID02"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("/*信号量结构体ID*/")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("static")]),t._v(" UINT32 g_usSemID"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("static")]),t._v(" VOID "),a("span",{attrs:{class:"token function"}},[t._v("Example_SemTask1")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("void")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    UINT32 uwRet"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{attrs:{class:"token function"}},[t._v("dprintf")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"Example_SemTask1 try get sem g_usSemID ,timeout 10 ticks.\\n"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("/*定时阻塞模式申请信号量，定时时间为10Tick*/")]),t._v("\n    uwRet "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("LOS_SemPend")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("g_usSemID"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("10")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{attrs:{class:"token comment"}},[t._v("/*申请到信号量*/")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LOS_OK "),a("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" uwRet"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{attrs:{class:"token function"}},[t._v("LOS_SemPost")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("g_usSemID"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("/*定时时间到，未申请到信号量*/")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LOS_ERRNO_SEM_TIMEOUT "),a("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" uwRet"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{attrs:{class:"token function"}},[t._v("dprintf")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"Example_SemTask1 timeout and try get sem g_usSemID wait forever.\\n"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{attrs:{class:"token comment"}},[t._v("/*永久阻塞模式申请信号量,获取不到时程序阻塞，不会返回*/")]),t._v("\n        uwRet "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("LOS_SemPend")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("g_usSemID"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" LOS_WAIT_FOREVER"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LOS_OK "),a("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" uwRet"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{attrs:{class:"token function"}},[t._v("dprintf")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"Example_SemTask1 wait_forever and got sem g_usSemID success.\\n"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{attrs:{class:"token function"}},[t._v("LOS_SemPost")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("g_usSemID"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            uwRet "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("LOS_InspectStatusSetByID")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LOS_INSPECT_SEM"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("LOS_INSPECT_STU_SUCCESS"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LOS_OK "),a("span",{attrs:{class:"token operator"}},[t._v("!=")]),t._v(" uwRet"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  \n            "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),a("span",{attrs:{class:"token function"}},[t._v("dprintf")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"Set Inspect Status Err\\n"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("static")]),t._v(" VOID "),a("span",{attrs:{class:"token function"}},[t._v("Example_SemTask2")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token keyword"}},[t._v("void")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    UINT32 uwRet"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token function"}},[t._v("dprintf")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"Example_SemTask2 try get sem g_usSemID wait forever.\\n"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("/*永久阻塞模式申请信号量*/")]),t._v("\n    uwRet "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("LOS_SemPend")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("g_usSemID"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" LOS_WAIT_FOREVER"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LOS_OK "),a("span",{attrs:{class:"token operator"}},[t._v("==")]),t._v(" uwRet"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{attrs:{class:"token function"}},[t._v("dprintf")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"Example_SemTask2 get sem g_usSemID and then delay 20ticks .\\n"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{attrs:{class:"token comment"}},[t._v("/*任务休眠20 Tick*/")]),t._v("\n    "),a("span",{attrs:{class:"token function"}},[t._v("LOS_TaskDelay")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("20")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{attrs:{class:"token function"}},[t._v("dprintf")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"Example_SemTask2 post sem g_usSemID .\\n"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("/*释放信号量*/")]),t._v("\n    "),a("span",{attrs:{class:"token function"}},[t._v("LOS_SemPost")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("g_usSemID"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nUINT32 "),a("span",{attrs:{class:"token function"}},[t._v("Example_Semphore")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("VOID"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    UINT32 uwRet "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" LOS_OK"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    TSK_INIT_PARAM_S stTask1"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    TSK_INIT_PARAM_S stTask2"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n   "),a("span",{attrs:{class:"token comment"}},[t._v("/*创建信号量*/")]),t._v("\n    "),a("span",{attrs:{class:"token function"}},[t._v("LOS_SemCreate")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("0")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("g_usSemID"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{attrs:{class:"token comment"}},[t._v("/*锁任务调度*/")]),t._v("\n    "),a("span",{attrs:{class:"token function"}},[t._v("LOS_TaskLock")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{attrs:{class:"token comment"}},[t._v("/*创建任务1*/")]),t._v("\n    "),a("span",{attrs:{class:"token function"}},[t._v("memset")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("stTask1"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("0")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("sizeof")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TSK_INIT_PARAM_S"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    stTask1"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pfnTaskEntry "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TSK_ENTRY_FUNC"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("Example_SemTask1"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    stTask1"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pcName       "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"MutexTsk1"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    stTask1"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("uwStackSize  "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" LOSCFG_BASE_CORE_TSK_IDLE_STACK_SIZE"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    stTask1"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("usTaskPrio   "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" TASK_PRIO_TEST"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    uwRet "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("LOS_TaskCreate")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("g_TestTaskID01"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("stTask1"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uwRet "),a("span",{attrs:{class:"token operator"}},[t._v("!=")]),t._v(" LOS_OK"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{attrs:{class:"token function"}},[t._v("dprintf")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"task1 create failed .\\n"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" LOS_NOK"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{attrs:{class:"token comment"}},[t._v("/*创建任务2*/")]),t._v("\n    "),a("span",{attrs:{class:"token function"}},[t._v("memset")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("stTask2"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("0")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("sizeof")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TSK_INIT_PARAM_S"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    stTask2"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pfnTaskEntry "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TSK_ENTRY_FUNC"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("Example_SemTask2"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    stTask2"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pcName       "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"MutexTsk2"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    stTask2"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("uwStackSize  "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" LOSCFG_BASE_CORE_TSK_IDLE_STACK_SIZE"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    stTask2"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("usTaskPrio   "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("TASK_PRIO_TEST "),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    uwRet "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("LOS_TaskCreate")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("g_TestTaskID02"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("stTask2"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("uwRet "),a("span",{attrs:{class:"token operator"}},[t._v("!=")]),t._v(" LOS_OK"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{attrs:{class:"token function"}},[t._v("dprintf")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"task2 create failed .\\n"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        \n        "),a("span",{attrs:{class:"token comment"}},[t._v("/*删除任务1*/")]),t._v("\n        "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("LOS_OK "),a("span",{attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("LOS_TaskDelete")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("g_TestTaskID01"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{attrs:{class:"token function"}},[t._v("dprintf")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"task1 delete failed .\\n"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        \n        "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" LOS_NOK"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{attrs:{class:"token comment"}},[t._v("/*解锁任务调度*/")]),t._v("\n    "),a("span",{attrs:{class:"token function"}},[t._v("LOS_TaskUnlock")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    uwRet "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("LOS_SemPost")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("g_usSemID"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{attrs:{class:"token comment"}},[t._v("/*任务休眠40 Tick*/")]),t._v("\n    "),a("span",{attrs:{class:"token function"}},[t._v("LOS_TaskDelay")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("40")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{attrs:{class:"token comment"}},[t._v("/*删除信号量*/")]),t._v("\n    "),a("span",{attrs:{class:"token function"}},[t._v("LOS_SemDelete")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("g_usSemID"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    "),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" uwRet"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  \n")])])])])}],!1,null,null,null);s.default=_.exports}}]);